<!DOCTYPE html>
<html lang="en" class="bg-white text-black transition-colors duration-300">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hostel Expense Planner</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body class="p-4 sm:p-6 max-w-2xl mx-auto font-sans">

  <!-- Header -->
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-gray-800 dark:text-white">ğŸ’° Hostel Expense Planner</h1>
    <button id="toggleTheme" class="text-xl px-3 py-1 bg-gray-200 dark:bg-gray-800 rounded hover:scale-105 transition">ğŸŒ™</button>
  </div>

  <!-- Expense Form -->
  <form id="expense-form" class="bg-white dark:bg-gray-900 shadow-xl rounded-2xl p-6 space-y-5 border dark:border-gray-700">
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
      <div>
        <label class="block font-medium">ğŸ“… Month & Year:</label>
        <input type="month" id="month" class="input" required />
      </div>
      <div>
        <label class="block font-medium">ğŸ¯ Allowance (â‚¹):</label>
        <input type="number" id="allowance" class="input" required />
      </div>
    </div>

    <h2 class="text-lg font-bold text-gray-700 dark:text-gray-200">ğŸ“Œ Fixed Expenses</h2>
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
      <input type="number" id="hostel" class="input" placeholder="Hostel Fee (â‚¹)" />
      <input type="number" id="current" class="input" placeholder="Current Bill (â‚¹)" />
      <input type="number" id="water" class="input" placeholder="Water Bill (â‚¹)" />
    </div>

    <h2 class="text-lg font-bold text-gray-700 dark:text-gray-200">ğŸ½ï¸ Daily Food</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
      <input type="number" id="dailyFood" class="input" placeholder="Daily Food (â‚¹)" />
      <input type="number" id="daysInMonth" class="input" value="30" placeholder="Days in Month" />
    </div>

    <h2 class="text-lg font-bold text-gray-700 dark:text-gray-200">ğŸ“± Others</h2>
    <div class="grid grid-cols-1 gap-4">
      <input type="number" id="recharge" class="input" placeholder="Recharge (â‚¹)" />
    </div>

    <button type="submit" class="w-full mt-2 bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 shadow-md">ğŸ’¾ Calculate & Save</button>
  </form>

  <!-- Result -->
  <div id="result" class="bg-white dark:bg-gray-900 mt-8 p-6 rounded-2xl shadow-xl border dark:border-gray-700 hidden">
    <div id="summary">
      <h2 class="text-xl font-bold text-gray-800 dark:text-gray-100 mb-4">ğŸ“Š Monthly Summary</h2>
      <p class="mb-1">ğŸ’¸ <strong>Total Expenses:</strong> â‚¹<span id="total-expense"></span></p>
      <p class="mb-1">ğŸ’¼ <strong>Money Left:</strong> â‚¹<span id="left-amount" class=""></span></p>
      <p class="mb-2">ğŸ± Food (â‚¹<span id="daily-food-show"></span> Ã— <span id="days-show"></span> days): â‚¹<span id="food-total"></span></p>
      <div id="suggestions" class="text-yellow-600 text-sm font-semibold mt-2"></div>
    </div>
    <canvas id="expenseChart" class="mt-4"></canvas>
    <button onclick="downloadPDF()" class="mt-6 w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">ğŸ“¥ Download Summary as PDF</button>
  </div>

  <!-- Monthly History -->
  <div class="mt-10 bg-white dark:bg-gray-900 p-5 rounded-2xl shadow-md border dark:border-gray-700">
    <h2 class="text-lg font-bold text-gray-800 dark:text-white mb-3">ğŸ—‚ï¸ View Previous Reports</h2>
    <ul id="history-list" class="text-sm space-y-2 text-gray-700 dark:text-gray-200"></ul>
  </div>

  <script>
    const form = document.getElementById("expense-form");
    const resultDiv = document.getElementById("result");
    const totalSpan = document.getElementById("total-expense");
    const leftSpan = document.getElementById("left-amount");
    const foodTotalSpan = document.getElementById("food-total");
    const dailyFoodShow = document.getElementById("daily-food-show");
    const daysShow = document.getElementById("days-show");
    const suggestions = document.getElementById("suggestions");
    const toggleBtn = document.getElementById("toggleTheme");
    let chart;

    // THEME
    toggleBtn.onclick = () => {
      document.documentElement.classList.toggle("dark");
      document.documentElement.classList.toggle("bg-gray-900");
      document.documentElement.classList.toggle("text-white");
      localStorage.setItem("theme", document.documentElement.classList.contains("dark") ? "dark" : "light");
    };

    window.onload = () => {
      if (localStorage.getItem("theme") === "dark") {
        document.documentElement.classList.add("dark", "bg-gray-900", "text-white");
      }
      loadHistory();
    };

    form.onsubmit = (e) => {
      e.preventDefault();
      const monthKey = document.getElementById("month").value;
      if (!monthKey) return alert("Please select a month!");

      const data = {
        allowance: +val("allowance"),
        hostel: +val("hostel"),
        current: +val("current"),
        water: +val("water"),
        dailyFood: +val("dailyFood"),
        daysInMonth: +val("daysInMonth"),
        recharge: +val("recharge")
      };

      const foodTotal = data.dailyFood * data.daysInMonth;
      const total = data.hostel + data.current + data.water + foodTotal + data.recharge;
      const left = data.allowance - total;

      const savedData = { ...data, foodTotal, total, left };
      localStorage.setItem("report_" + monthKey, JSON.stringify(savedData));
      loadHistory();
      renderSummary(savedData);
    };

    function val(id) {
      return document.getElementById(id).value || 0;
    }

    function renderSummary(data) {
      totalSpan.textContent = data.total;
      leftSpan.textContent = data.left;
      leftSpan.className = data.left >= 0 ? "text-green-600 font-bold" : "text-red-600 font-bold";
      foodTotalSpan.textContent = data.foodTotal;
      dailyFoodShow.textContent = data.dailyFood;
      daysShow.textContent = data.daysInMonth;

      suggestions.innerHTML = "";
      if (data.foodTotal > data.allowance * 0.4)
        suggestions.innerHTML += "âš ï¸ High food cost! Try reducing it.<br>";
      if (data.left < 0)
        suggestions.innerHTML += "â— You're overspending! Create a saving plan.";

      const labels = ["Hostel", "Current", "Water", "Food", "Recharge"];
      const chartData = [data.hostel, data.current, data.water, data.foodTotal, data.recharge];

      if (chart) chart.destroy();
      chart = new Chart(document.getElementById("expenseChart"), {
        type: "pie",
        data: {
          labels,
          datasets: [{
            data: chartData,
            backgroundColor: ["#f87171", "#60a5fa", "#34d399", "#facc15", "#a78bfa"]
          }]
        }
      });

      resultDiv.classList.remove("hidden");
      window.scrollTo({ top: resultDiv.offsetTop, behavior: "smooth" });
    }

    function downloadPDF() {
      const chart = document.getElementById("expenseChart");
      const originalDisplay = chart.style.display;
      chart.style.display = "none";  // Temporarily hide chart

      const summary = document.getElementById("summary");

      const opt = {
        margin: 0.5,
        filename: "hostel_expense_summary.pdf",
        image: { type: "jpeg", quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: "in", format: "letter", orientation: "portrait" }
      };

      html2pdf().set(opt).from(summary).save().then(() => {
        chart.style.display = originalDisplay; // Restore chart
      });
    }

    function loadHistory() {
      const historyList = document.getElementById("history-list");
      historyList.innerHTML = "";
      for (let key in localStorage) {
        if (key.startsWith("report_")) {
          const month = key.replace("report_", "");
          historyList.innerHTML += `
            <li class="flex justify-between items-center">
              <span>${month}</span>
              <button onclick="viewReport('${month}')" class="text-blue-600 hover:underline">View</button>
            </li>
          `;
        }
      }
    }

    function viewReport(monthKey) {
      const data = JSON.parse(localStorage.getItem("report_" + monthKey));
      if (data) renderSummary(data);
    }
  </script>

  <style>
    .input {
      width: 100%;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #ccc;
      background-color: white;
      transition: 0.2s ease;
    }
    .input:focus {
      outline: none;
      border-color: #60a5fa;
      box-shadow: 0 0 0 2px rgba(96, 165, 250, 0.3);
    }
    .dark .input {
      background-color: #1f2937;
      color: white;
      border-color: #4b5563;
    }
  </style>
</body>
</html>
